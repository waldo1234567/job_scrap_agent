version: '3.11.13'
services:
  chrome:
    image: selenium/standalone-chrome:115.0
    container_name: chrome
    shm_size: '2gb'
    ports:
      - "4444:4444"
    volumes:
      - "./snapshots:/app/snapshots"
  
  app:
    build: ./
    container_name: job_scrap_agent
    depends_on:
      - chrome
    env_file:
      - .env
    environment:
      - CHROME_REMOTE_URL=${CHROME_REMOTE_URL}
      - SCRAPE_HEADLESS=${SCRAPE_HEADLESS}
      - SCHEDULE_CRON_HOUR=${SCHEDULE_CRON_HOUR}
      - SCHEDULE_CRON_MINUTE=${SCHEDULE_CRON_MINUTE}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
    volumes:
      - ./jobs.db:/app/jobs.db
      - ./snapshots:/app/snapshots
      - ./scheduler.log:/app/scheduler.log
    ports:
      - "7860:7860"
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://127.0.0.1:5001/health || exit 1"]
      interval: 1m30s
      timeout: 30s
      retries: 5
      start_period: 30s